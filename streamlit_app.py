import streamlit as st
import numpy as np

st.set_page_config(page_title="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–µ—Ä–æ–º—ã", layout="centered")

st.title("üìä –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Å–µ—Ä–æ–º—ã")
st.markdown("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Å–µ—Ä–æ–º—ã –≤ –ø–æ—Å–ª–µ–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º –ø–µ—Ä–∏–æ–¥–µ –ø–æ –º—É–ª—å—Ç–∏—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –º–æ–¥–µ–ª–∏ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏.")

# –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
BMI = st.number_input("–ò–Ω–¥–µ–∫—Å –º–∞—Å—Å—ã —Ç–µ–ª–∞ (–ò–ú–¢)", min_value=10.0, max_value=50.0, value=25.0, step=0.1)
surgery_type = st.selectbox("–¢–∏–ø –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞", ["eTEP", "TAPP"])
hernia_history = st.checkbox("–ì—Ä—ã–∂–µ—Å–µ—á–µ–Ω–∏–µ –≤ –∞–Ω–∞–º–Ω–µ–∑–µ")
asa_class = st.selectbox("ASA –∫–ª–∞—Å—Å", ["I‚ÄìII", "III (–≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫)"])

# –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
x_surgery = 1 if surgery_type == "TAPP" else 0           # TAPP = 1
x_hernia_history = 1 if hernia_history else 0            # –î–∞ = 1
x_asa = 1 if asa_class == "III (–≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫)" else 0     # ASA III = 1
x_bmi = BMI

# –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∏–∑ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏
B0 = 1.669
B_surgery = -0.975
B_hernia = 2.018
B_asa = -1.418
B_bmi = -0.007

# –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ç–∞ –∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
logit = (
    B0 +
    B_surgery * x_surgery +
    B_hernia * x_hernia_history +
    B_asa * x_asa +
    B_bmi * x_bmi
)

prob = 1 / (1 + np.exp(-logit))
prob_pct = min(max(prob * 100, 0), 100)

# –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
st.markdown("## üßÆ –†–µ–∑—É–ª—å—Ç–∞—Ç:")
st.success(f"üîπ –†–∞—Å—á—ë—Ç–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–µ—Ä–æ–º—ã: **{prob_pct:.2f}%**")

# –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–∏—Å–∫–∞
if prob < 0.1:
    st.info("üü¢ –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ —Å–µ—Ä–æ–º—ã")
elif prob < 0.5:
    st.warning("üü° –£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–∏—Å–∫ —Å–µ—Ä–æ–º—ã")
else:
    st.error("üî¥ –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ —Å–µ—Ä–æ–º—ã")

# –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
st.progress(min(prob, 1.0))
