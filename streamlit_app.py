import streamlit as st
import numpy as np

st.set_page_config(page_title="–ü—Ä–æ–≥–Ω–æ–∑ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π", layout="centered")

st.title("üìä –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π")
st.markdown("–ù–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å **–ø–æ—Å–ª–µ–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–µ—Ä–æ–º—ã** –∏ **–±–æ–ª–µ–≤–æ–≥–æ —Å–∏–Ω–¥—Ä–æ–º–∞**.")

# üîΩ –í–í–û–î –î–ê–ù–ù–´–• –û–î–ò–ù –î–õ–Ø –û–ë–ï–ò–• –ú–û–î–ï–õ–ï–ô --------------------------------------------------
st.header("üìù –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–∞")

BMI = st.number_input("–ò–Ω–¥–µ–∫—Å –º–∞—Å—Å—ã —Ç–µ–ª–∞ (–ò–ú–¢)", min_value=10.0, max_value=50.0, value=25.0, step=0.1)

surgery_type = st.selectbox("–¢–∏–ø –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞", ["eTEP", "TAPP"])
hernia_history = st.checkbox("–ì—Ä—ã–∂–µ—Å–µ—á–µ–Ω–∏–µ –≤ –∞–Ω–∞–º–Ω–µ–∑–µ")
asa_class = st.selectbox("ASA –∫–ª–∞—Å—Å", ["I‚ÄìII", "III (–≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫)"])

# üß† –ö–û–î–ò–†–û–í–ö–ê –ü–ï–†–ï–ú–ï–ù–ù–´–•
x_surgery = 1 if surgery_type == "TAPP" else 0
x_hernia = 1 if hernia_history else 0
x_asa = 1 if asa_class == "III (–≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫)" else 0
x_bmi = BMI

# ======================================================================================

# üìå –ú–û–î–ï–õ–¨ 1 ‚Äî –°–ï–†–û–ú–ê
st.header("üíß –ü—Ä–æ–≥–Ω–æ–∑ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–µ—Ä–æ–º—ã")

# –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã (–∏–∑ –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã)
B0_seroma = 1.669
B_surgery_seroma = -0.975
B_hernia_seroma = 2.018
B_asa_seroma = -1.418
B_bmi_seroma = -0.007

logit_seroma = (
    B0_seroma +
    B_surgery_seroma * x_surgery +
    B_hernia_seroma * x_hernia +
    B_asa_seroma * x_asa +
    B_bmi_seroma * x_bmi
)

prob_seroma = 1 / (1 + np.exp(-logit_seroma))
pct_seroma = min(max(prob_seroma * 100, 0), 100)

st.success(f"üîπ –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–µ—Ä–æ–º—ã: **{pct_seroma:.2f}%**")
st.progress(min(prob_seroma, 1.0))

# ‚ñ™ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–∏—Å–∫–∞:
if prob_seroma < 0.1:
    st.info("üü¢ –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ —Å–µ—Ä–æ–º—ã")
elif prob_seroma < 0.5:
    st.warning("üü° –£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–∏—Å–∫ —Å–µ—Ä–æ–º—ã")
else:
    st.error("üî¥ –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ —Å–µ—Ä–æ–º—ã")


# ======================================================================================

# üìå –ú–û–î–ï–õ–¨ 2 ‚Äî –ë–û–õ–ï–í–û–ô –°–ò–ù–î–†–û–ú
st.header("üí• –ü—Ä–æ–≥–Ω–æ–∑ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –±–æ–ª–µ–≤–æ–≥–æ —Å–∏–Ω–¥—Ä–æ–º–∞")

# –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∏–∑ –≤—Ç–æ—Ä–æ–π –º–æ–¥–µ–ª–∏
B0_pain = 1.669
B_surgery_pain = -0.0975
B_hernia_pain = 2.018
B_asa_pain = -1.418
B_bmi_pain = -0.007

logit_pain = (
    B0_pain +
    B_surgery_pain * x_surgery +
    B_hernia_pain * x_hernia +
    B_asa_pain * x_asa +
    B_bmi_pain * x_bmi
)

prob_pain = 1 / (1 + np.exp(-logit_pain))
pct_pain = min(max(prob_pain * 100, 0), 100)

st.success(f"üîπ –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±–æ–ª–µ–≤–æ–≥–æ —Å–∏–Ω–¥—Ä–æ–º–∞: **{pct_pain:.2f}%**")
st.progress(min(prob_pain, 1.0))

# ‚ñ™ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–∏—Å–∫–∞:
if prob_pain < 0.1:
    st.info("üü¢ –ù–∏–∑–∫–∏–π –±–æ–ª–µ–≤–æ–π —Ä–∏—Å–∫")
elif prob_pain < 0.5:
    st.warning("üü° –£–º–µ—Ä–µ–Ω–Ω—ã–π –±–æ–ª–µ–≤–æ–π —Ä–∏—Å–∫")
else:
    st.error("üî¥ –í—ã—Å–æ–∫–∏–π –±–æ–ª–µ–≤–æ–π —Ä–∏—Å–∫")
