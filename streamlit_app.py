import streamlit as st

st.set_page_config(
    page_title="ÐŸÑ€Ð¾Ð³Ð½Ð¾Ð· Ð¾ÑÐ»Ð¾Ð¶Ð½ÐµÐ½Ð¸Ð¹ Ð¿Ð¾ÑÐ»Ðµ Ð»Ð°Ð¿Ð°Ñ€Ð¾ÑÐºÐ¾Ð¿Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð³ÐµÑ€Ð½Ð¸Ð¾Ð¿Ð»Ð°ÑÑ‚Ð¸ÐºÐ¸",
    page_icon="ðŸ©º",
    layout="centered"
)

st.title("ÐŸÑ€Ð¾Ð³Ð½Ð¾Ð· Ð¾ÑÐ»Ð¾Ð¶Ð½ÐµÐ½Ð¸Ð¹ Ð¿Ð¾ÑÐ»Ðµ Ð»Ð°Ð¿Ð°Ñ€Ð¾ÑÐºÐ¾Ð¿Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð³ÐµÑ€Ð½Ð¸Ð¾Ð¿Ð»Ð°ÑÑ‚Ð¸ÐºÐ¸")

tabs = st.tabs(["Ð¡ÐµÑ€Ð¾Ð¼Ð°", "Ð‘Ð¾Ð»ÑŒ"])


# ======================================================================
# ===========================  Ð¡Ð•Ð ÐžÐœÐ  =================================
# ======================================================================
with tabs[0]:
    st.subheader("Ð Ð¸ÑÐº ÑÐµÑ€Ð¾Ð¼Ñ‹ (Ð±Ð°Ð»Ð»ÑŒÐ½Ð°Ñ ÑˆÐºÐ°Ð»Ð°)")

    st.markdown(
        "Ð¨ÐºÐ°Ð»Ð° Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð° Ð½Ð° Ñ„Ð°ÐºÑ‚Ð¾Ñ€Ð°Ñ…, Ð°ÑÑÐ¾Ñ†Ð¸Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ñ Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ ÑÐµÑ€Ð¾Ð¼Ñ‹ Ð² Ð¿Ð¾ÑÐ»ÐµÐ¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð¼ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ðµ: "
        "Ñ‚Ð¸Ð¿ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¸Ð²Ð½Ð¾Ð³Ð¾ Ð²Ð¼ÐµÑˆÐ°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð°, Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ð³Ñ€Ñ‹Ð¶ÐµÑÐµÑ‡ÐµÐ½Ð¸Ñ Ð² Ð°Ð½Ð°Ð¼Ð½ÐµÐ·Ðµ Ð¸ ÐºÐ»Ð°ÑÑ ASA."
    )

    # Ð‘Ð°Ð»Ð»ÑŒÐ½Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð´Ð»Ñ ÑÐµÑ€Ð¾Ð¼Ñ‹:
    # - Ð“Ñ€Ñ‹Ð¶ÐµÑÐµÑ‡ÐµÐ½Ð¸Ðµ Ð² Ð°Ð½Ð°Ð¼Ð½ÐµÐ·Ðµ (Ñ€ÐµÑ†Ð¸Ð´Ð¸Ð²): +2 Ð±Ð°Ð»Ð»Ð°
    # - TAPP (Ð¿Ð¾ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸ÑŽ Ñ eTEP): +1 Ð±Ð°Ð»Ð»
    # - ASA III: +1 Ð±Ð°Ð»Ð»
    # 0â€“1 Ð±Ð°Ð»Ð»  â†’ Ð½Ð¸Ð·ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº ÑÐµÑ€Ð¾Ð¼Ñ‹
    # 2â€“3 Ð±Ð°Ð»Ð»Ð° â†’ ÑƒÐ¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¹ Ñ€Ð¸ÑÐº
    # â‰¥4 Ð±Ð°Ð»Ð»Ð¾Ð² â†’ Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº

    def seroma_risk_score(
        surg_type: str,
        prior_hernia: bool,
        asa_label: str
    ) -> int:
        score = 0

        # Ð“Ñ€Ñ‹Ð¶ÐµÑÐµÑ‡ÐµÐ½Ð¸Ðµ Ð² Ð°Ð½Ð°Ð¼Ð½ÐµÐ·Ðµ (Ñ€ÐµÑ†Ð¸Ð´Ð¸Ð²)
        if prior_hernia:
            score += 2

        # Ð¢Ð¸Ð¿ Ð²Ð¼ÐµÑˆÐ°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð°
        if surg_type == "TAPP":
            score += 1  # eTEP â€” 0

        # ASA
        if asa_label == "III":
            score += 1

        return score

    def seroma_risk_category(score: int) -> str:
        if score <= 1:
            return "ÐÐ¸Ð·ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº"
        if score <= 3:
            return "Ð£Ð¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¹ Ñ€Ð¸ÑÐº"
        return "Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº"

    c1, c2 = st.columns(2)

    with c1:
        surg_label_s = st.selectbox(
            "Ð¢Ð¸Ð¿ Ð²Ð¼ÐµÑˆÐ°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð°",
            options=["TAPP", "eTEP"],
            key="s_surg"
        )

        prior_hernia_s = st.checkbox(
            "Ð“Ñ€Ñ‹Ð¶ÐµÑÐµÑ‡ÐµÐ½Ð¸Ðµ Ð² Ð°Ð½Ð°Ð¼Ð½ÐµÐ·Ðµ (Ñ€ÐµÑ†Ð¸Ð´Ð¸Ð²Ð½Ð°Ñ Ð³Ñ€Ñ‹Ð¶Ð°)",
            value=False,
            key="s_prior_hernia"
        )

    with c2:
        asa_label_s = st.selectbox(
            "ASA (ÐºÐ»Ð°ÑÑ)",
            options=["I", "II", "III"],
            index=1,
            key="s_asa"
        )

    score_seroma = seroma_risk_score(
        surg_type=surg_label_s,
        prior_hernia=prior_hernia_s,
        asa_label=asa_label_s
    )
    cat_seroma = seroma_risk_category(score_seroma)

    st.write("---")
    st.markdown(f"**Ð¡ÑƒÐ¼Ð¼Ð°Ñ€Ð½Ñ‹Ð¹ Ð±Ð°Ð»Ð» Ð¿Ð¾ ÑˆÐºÐ°Ð»Ðµ ÑÐµÑ€Ð¾Ð¼Ñ‹:** {score_seroma}")
    st.markdown(f"**ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ Ñ€Ð¸ÑÐºÐ° ÑÐµÑ€Ð¾Ð¼Ñ‹:** {cat_seroma}")

    if cat_seroma == "ÐÐ¸Ð·ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº":
        st.success("ÐÐ¸Ð·ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÑÐµÑ€Ð¾Ð¼Ñ‹ Ð² Ñ€Ð°Ð½Ð½ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð¼ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ðµ.")
    elif cat_seroma == "Ð£Ð¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¹ Ñ€Ð¸ÑÐº":
        st.warning("Ð£Ð¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¹ Ñ€Ð¸ÑÐº ÑÐµÑ€Ð¾Ð¼Ñ‹.")
    else:
        st.error("Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº ÑÐµÑ€Ð¾Ð¼Ñ‹. Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð±Ð¾Ð»ÐµÐµ Ñ‚Ñ‰Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð½Ð°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ðµ Ð¸ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ð°ÐºÑ‚Ð¸ÐºÐ°.")


# ======================================================================
# =========================  Ð‘ÐžÐ›Ð¬ (ÑˆÐºÐ°Ð»Ð°)  ==============================
# ======================================================================
with tabs[1]:
    st.subheader("Ð Ð¸ÑÐº Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð½Ð¾Ð¹ Ð¿Ð¾ÑÐ»ÐµÐ¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð¹ Ð±Ð¾Ð»Ð¸ (Ð±Ð°Ð»Ð»ÑŒÐ½Ð°Ñ ÑˆÐºÐ°Ð»Ð°)")

    st.markdown(
        "Ð¨ÐºÐ°Ð»Ð° Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð° Ð½Ð° Ð¼ÐµÑ‚Ð¾Ð´Ðµ Ð²Ð¼ÐµÑˆÐ°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð°, ÑÐ¿Ð¾ÑÐ¾Ð±Ðµ Ñ„Ð¸ÐºÑÐ°Ñ†Ð¸Ð¸ Ð¸Ð¼Ð¿Ð»Ð°Ð½Ñ‚Ð°Ñ‚Ð°, Ð¸Ð½Ð´ÐµÐºÑÐµ Ð¼Ð°ÑÑÑ‹ Ñ‚ÐµÐ»Ð° "
        "Ð¸ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ð¸ Ð³Ñ€Ñ‹Ð¶ÐµÑÐµÑ‡ÐµÐ½Ð¸Ñ Ð² Ð°Ð½Ð°Ð¼Ð½ÐµÐ·Ðµ."
    )

    # Ð‘Ð°Ð»Ð»ÑŒÐ½Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð´Ð»Ñ Ð±Ð¾Ð»Ð¸:
    # - TAPP: +2 Ð±Ð°Ð»Ð»Ð°
    # - eTEP: 0 Ð±Ð°Ð»Ð»Ð¾Ð²
    #
    # - Ð¤Ð¸ÐºÑÐ°Ñ†Ð¸Ñ ÑÑ‚ÐµÐ¿Ð»ÐµÑ€Ð¾Ð¼: +2 Ð±Ð°Ð»Ð»Ð°
    # - ÐšÐ¾Ð¼Ð±Ð¸Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ñ„Ð¸ÐºÑÐ°Ñ†Ð¸Ñ: +1 Ð±Ð°Ð»Ð»
    # - ÐšÐ»ÐµÐ¹: 0 Ð±Ð°Ð»Ð»Ð¾Ð²
    #
    # - Ð˜ÐœÐ¢ >= 30 ÐºÐ³/Ð¼Â²: +1 Ð±Ð°Ð»Ð»
    #
    # - Ð“Ñ€Ñ‹Ð¶ÐµÑÐµÑ‡ÐµÐ½Ð¸Ðµ Ð² Ð°Ð½Ð°Ð¼Ð½ÐµÐ·Ðµ (Ñ€ÐµÑ†Ð¸Ð´Ð¸Ð²): +1 Ð±Ð°Ð»Ð»
    #
    # 0â€“1 Ð±Ð°Ð»Ð»  â†’ Ð½Ð¸Ð·ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð½Ð¾Ð¹ Ð±Ð¾Ð»Ð¸
    # 2â€“3 Ð±Ð°Ð»Ð»Ð° â†’ ÑƒÐ¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¹ Ñ€Ð¸ÑÐº
    # â‰¥4 Ð±Ð°Ð»Ð»Ð¾Ð² â†’ Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº

    def pain_risk_score(
        surg_type: str,
        fix_type: str,
        bmi: float,
        prior_hernia: bool
    ) -> int:
        score = 0

        # Ð¢Ð¸Ð¿ Ð²Ð¼ÐµÑˆÐ°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð°
        if surg_type == "TAPP":
            score += 2
        else:
            score += 0  # eTEP

        # Ð¡Ð¿Ð¾ÑÐ¾Ð± Ñ„Ð¸ÐºÑÐ°Ñ†Ð¸Ð¸
        if fix_type == "Ð“ÐµÑ€Ð½Ð¸Ð¾ÑÑ‚ÐµÐ¿Ð»ÐµÑ€":
            score += 2
        elif fix_type == "ÐšÐ¾Ð¼Ð±Ð¸Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹":
            score += 1
        else:  # "ÐšÐ»ÐµÐ¹"
            score += 0

        # Ð˜ÐœÐ¢
        if bmi >= 30.0:
            score += 1

        # Ð ÐµÑ†Ð¸Ð´Ð¸Ð²Ð½Ð°Ñ Ð³Ñ€Ñ‹Ð¶Ð° / Ð³Ñ€Ñ‹Ð¶ÐµÑÐµÑ‡ÐµÐ½Ð¸Ðµ Ð² Ð°Ð½Ð°Ð¼Ð½ÐµÐ·Ðµ
        if prior_hernia:
            score += 1

        return score

    def pain_risk_category(score: int) -> str:
        if score <= 1:
            return "ÐÐ¸Ð·ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº"
        if score <= 3:
            return "Ð£Ð¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¹ Ñ€Ð¸ÑÐº"
        return "Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº"

    p1, p2 = st.columns(2)

    with p1:
        surg_label_p = st.selectbox(
            "Ð¢Ð¸Ð¿ Ð²Ð¼ÐµÑˆÐ°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð°",
            options=["TAPP", "eTEP"],
            key="p_surg"
        )

        fix_label_p = st.selectbox(
            "Ð¡Ð¿Ð¾ÑÐ¾Ð± Ñ„Ð¸ÐºÑÐ°Ñ†Ð¸Ð¸ Ð¸Ð¼Ð¿Ð»Ð°Ð½Ñ‚Ð°Ñ‚Ð°",
            options=["Ð“ÐµÑ€Ð½Ð¸Ð¾ÑÑ‚ÐµÐ¿Ð»ÐµÑ€", "ÐšÐ»ÐµÐ¹", "ÐšÐ¾Ð¼Ð±Ð¸Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹"],
            key="p_fix"
        )

        prior_hernia_p = st.checkbox(
            "Ð“Ñ€Ñ‹Ð¶ÐµÑÐµÑ‡ÐµÐ½Ð¸Ðµ Ð² Ð°Ð½Ð°Ð¼Ð½ÐµÐ·Ðµ (Ñ€ÐµÑ†Ð¸Ð´Ð¸Ð²Ð½Ð°Ñ Ð³Ñ€Ñ‹Ð¶Ð°)",
            key="p_prior_hernia"
        )

    with p2:
        bmi_p = st.number_input(
            "Ð˜ÐœÐ¢, ÐºÐ³/Ð¼Â²",
            min_value=10.0,
            max_value=70.0,
            step=0.1,
            value=26.0,
            key="p_bmi"
        )

    score_pain = pain_risk_score(
        surg_type=surg_label_p,
        fix_type=fix_label_p,
        bmi=bmi_p,
        prior_hernia=prior_hernia_p
    )
    cat_pain = pain_risk_category(score_pain)

    st.write("---")
    st.markdown(f"**Ð¡ÑƒÐ¼Ð¼Ð°Ñ€Ð½Ñ‹Ð¹ Ð±Ð°Ð»Ð» Ð¿Ð¾ ÑˆÐºÐ°Ð»Ðµ Ð±Ð¾Ð»Ð¸:** {score_pain}")
    st.markdown(f"**ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ Ñ€Ð¸ÑÐºÐ° Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð½Ð¾Ð¹ Ð±Ð¾Ð»Ð¸:** {cat_pain}")

    if cat_pain == "ÐÐ¸Ð·ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº":
        st.success("ÐÐ¸Ð·ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð½Ð¾Ð¹ Ð±Ð¾Ð»Ð¸ Ð² Ñ€Ð°Ð½Ð½ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð¼ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ðµ.")
    elif cat_pain == "Ð£Ð¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¹ Ñ€Ð¸ÑÐº":
        st.warning("Ð£Ð¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¹ Ñ€Ð¸ÑÐº Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð½Ð¾Ð¹ Ð±Ð¾Ð»Ð¸.")
    else:
        st.error(
            "Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð½Ð¾Ð¹ Ð±Ð¾Ð»Ð¸. ÐŸÐ°Ñ†Ð¸ÐµÐ½Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ð½ÑƒÐ¶Ð´Ð°Ñ‚ÑŒÑÑ Ð² Ð±Ð¾Ð»ÐµÐµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ð¼ "
            "Ð¾Ð±ÐµÐ·Ð±Ð¾Ð»Ð¸Ð²Ð°Ð½Ð¸Ð¸ Ð¸ Ð½Ð°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ð¸."
        )
